<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.douzone.prosync.task_status.repository.TaskStatusMapper">
    <insert id="save" useGeneratedKeys="true" keyProperty="taskStatus.taskStatusId">
        insert into task_status (task_status, color, project_id, created_at, modified_at, seq)
        values (#{taskStatus.taskStatus}, #{taskStatus.color}, #{projectId}, #{taskStatus.createdAt},
                #{taskStatus.createdAt}, 0);
    </insert>
    <update id="update">
        update task_status
        <set>
            modified_at=#{modifiedAt},
            <if test="taskStatus != null">
                task_status=#{taskStatus},
            </if>
            <if test="color != null">
                color=#{color},
            </if>
            <if test="seq != null">
                seq=#{seq},
            </if>
        </set>
        where task_status_id = #{taskStatusId}
          and is_deleted is null;
    </update>
    <select id="findExistsTaskStatus" resultType="int">
        select count(*)
        from task_status
        where task_status_id = #{taskStatusId}
          and is_deleted is null;
    </select>
    <select id="findTaskStatusByProject">
        select task_status_id, color, task_status, seq
        from task_status
        <where>
            project_id=#{projectId} and is_deleted is null
            <if test="isActive">
                and seq != 0
            </if>
        </where>
    </select>
</mapper>